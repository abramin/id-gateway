# 2026-01-01

## Top Risks
- Admin endpoints can be effectively unauthenticated if `ADMIN_API_TOKEN` is unset; empty `expectedToken` passes when request header is empty, so a misconfigured prod deploy exposes admin surface. `pkg/platform/middleware/admin/admin.go`. `internal/platform/config/config.go`.
- Auth flow allows anyone to claim any email and auto-provisions users, which is acceptable for demos but catastrophic in production (full account impersonation). `internal/auth/service/authorize.go`. `internal/auth/models/requests.go`. `docs/openapi/auth.yaml`.
- Client binding is incomplete: `aud` is global, not `client_id`, and there’s no `aud`/client validation in middleware, no client_secret verification for confidential clients, and PKCE is not implemented; this makes code interception and token replay realistic. `internal/jwt_token/jwt.go`. `pkg/platform/middleware/auth/auth.go`. `internal/auth/service/token_exchange.go`. `internal/auth/models/requests.go`. `docs/openapi/auth.yaml`.
- Signing key management is HS256 with a static secret and permissive defaults; no JWKS, no rotation, and a dev fallback key if env isn’t set. This blocks external resource servers and increases blast radius on key leak. `internal/jwt_token/jwt.go`. `internal/platform/config/config.go`. `docs/overview/ROADMAP.md`.
- Core state is in-memory (sessions, refresh tokens, consent, rate limits, revocation, audit), which fails on restart and is inconsistent across instances; this breaks revocation, consent enforcement, and compliance expectations. `internal/auth/store/session/store_memory.go`. `internal/auth/store/revocation/revocation.go`. `internal/consent/store/store_memory.go`. `internal/ratelimit/store`. `pkg/platform/audit/store/memory/store_memory.go`.
- Revocation can fail open: TRL write errors default to “warn,” and only the latest access-token JTI is stored, leaving earlier tokens valid until expiry even after session revocation. `internal/auth/service/service.go`. `internal/auth/service/token_revocation.go`. `internal/auth/models/models.go`.

## Missing System Artifacts
- ADRs for: token signing/rotation strategy, persistence architecture (DB + Redis), tenant isolation model, and client authentication/PKCE enforcement. `docs/engineering/architecture.md`. `docs/overview/ROADMAP.md`.
- Runbooks for: key rotation, revocation-list outage behavior, audit pipeline backpressure/drops, and incident response for auth outages. `docs/security/SECURITY_ASSURANCE_PLAYBOOK.md`.
- Production deployment guides: backup/restore, migration/rollback, and data retention enforcement. `docs/security/compliance.md`. `docs/overview/ROADMAP.md`.
- Security CI parity with the playbook (Semgrep/DAST/Trivy/SBOM) is not wired in workflows. `docs/security/SECURITY_ASSURANCE_PLAYBOOK.md`. `.github/workflows/ci.yml`.

## Metrics and Alerts to Add
- Auth SLIs: p95/p99 latency and error rates for `/auth/authorize`, `/auth/token`, `/auth/revoke` split by tenant and client. `docs/openapi/auth.yaml`.
- Revocation health: TRL write failures, revocation lag, and revoked-token check failures. `internal/auth/service/token_revocation.go`. `internal/auth/store/revocation/revocation.go`.
- Audit durability: outbox backlog, publish failures, persist failures, and time-to-persist. `pkg/platform/audit/outbox/worker/worker.go`. `pkg/platform/audit/store/postgres/store.go`.
- Abuse signals: refresh-token reuse detections, auth lockouts, and rate-limit denials by IP/client. `internal/auth/service/token_refresh.go`. `internal/ratelimit/service`.
- Consent gating failures and regulated-mode PII minimization violations. `internal/consent/service/service.go`. `docs/security/compliance.md`.

## Rollout Strategies
- Enforce `ADMIN_API_TOKEN` presence outside demo/local and fail fast on startup; add a safety check in deployment templates. `internal/platform/config/config.go`.
- PKCE rollout in phases: log-only → warn → enforce for public clients; block `authorization_code` without code_verifier once clients are ready. `docs/prd/PRD-041-OAuth-Extension-Pack.md`.
- Token signing migration: dual-issuer window (HS256 + RS256) with JWKS exposure, then revoke old keys. `docs/overview/ROADMAP.md`.
- Persistence migration: dual-write in-memory + DB, cutover with read-after-write verification, then remove in-memory. `docs/overview/ROADMAP.md`.
- Revocation hardening: switch TRL to Redis, and choose explicit fail-closed behavior for revoke operations. `internal/auth/service/service.go`.

## Candidate ADR / RFC Topics
- OAuth client authentication model (public vs confidential, PKCE requirements, secret handling). `internal/tenant/models/client.go`. `internal/auth/models/requests.go`.
- Token audience and issuer validation rules (aud = client_id, tenant-scoped issuer format). `internal/jwt_token/jwt.go`. `docs/openapi/auth.yaml`.
- Revocation semantics (fail-closed vs fail-open, JTI storage strategy). `internal/auth/service/token_revocation.go`.
- Audit durability guarantees (outbox backlog, publish retries, storage backend). `pkg/platform/audit/outbox/worker/worker.go`. `pkg/platform/audit/store/postgres/store.go`.
- Multi-tenant data isolation and cross-tenant access boundaries across services. `docs/engineering/ddd.md`. `internal/tenant`.

## Strengths
- Clear modular boundaries with ports/adapters and explicit DDD guidance. `docs/engineering/architecture.md`. `docs/engineering/ddd.md`.
- Strong PRD coverage and explicit phase plan; transparent about what is planned vs implemented. `docs/prd/README.md`. `docs/overview/ROADMAP.md`.
- Good test scaffolding: unit/integration + e2e with mock registries and race tests. `.github/workflows/ci.yml`. `e2e/README.md`.
- Consent and token lifecycle concepts are explicit and reflected in code and OpenAPI. `internal/consent`. `internal/auth/service`. `docs/openapi/auth.yaml`.
- Security awareness is embedded (device binding design, attack lab, playbook). `docs/security/DEVICE_BINDING.md`. `lab/`. `docs/security/SECURITY_ASSURANCE_PLAYBOOK.md`.

## Assumptions
- I reviewed docs and core auth/tenant/consent/audit/rate-limit code paths but did not run the system or tests. I’m treating the current state as demo/MVP while evaluating production risk.
